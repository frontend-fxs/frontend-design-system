(function(){FXStreetWidgets.Widget.Base=function(n){var t={};return t.Container=FXStreetWidgets.Widget.Base.prototype.Container,t.loaderBase=n,t.data=FXStreetWidgets.Widget.Base.prototype.data,t.interval=FXStreetWidgets.Widget.Base.prototype.interval,t.init=FXStreetWidgets.Widget.Base.prototype.init,t.setSettingsByObject=FXStreetWidgets.Widget.Base.prototype.setSettingsByObject,t.addEvents=FXStreetWidgets.Widget.Base.prototype.addEvents,t.setVars=FXStreetWidgets.Widget.Base.prototype.setVars,t.loadData=FXStreetWidgets.Widget.Base.prototype.loadData,t.loadDataFromUrl=FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl,t.setDatesToJson=FXStreetWidgets.Widget.Base.prototype.setDatesToJson,t.renderHtml=FXStreetWidgets.Widget.Base.prototype.renderHtml,t.log=FXStreetWidgets.Widget.Base.prototype.log,t.jsonDataIsValid=FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid,t.handleJsonInvalidData=FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData,t};FXStreetWidgets.Widget.Base.prototype.Container=null;FXStreetWidgets.Widget.Base.prototype.loaderBase=null;FXStreetWidgets.Widget.Base.prototype.data=null;FXStreetWidgets.Widget.Base.prototype.interval=null;FXStreetWidgets.Widget.Base.prototype.init=function(n){this.setSettingsByObject(n)};FXStreetWidgets.Widget.Base.prototype.setSettingsByObject=function(n){for(var t in n)n.hasOwnProperty(t)&&this[t]!==undefined&&(this[t]=n[t])};FXStreetWidgets.Widget.Base.prototype.addEvents=function(){};FXStreetWidgets.Widget.Base.prototype.setVars=function(){};FXStreetWidgets.Widget.Base.prototype.loadData=function(n){this.loadDataFromUrl(this.loaderBase.config.EndPoint,n)};FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl=function(n,t){var i=this;FXStreetWidgets.Util.ajaxJsonGetter(n,t).done(function(n){if(!i.jsonDataIsValid(n)){i.handleJsonInvalidData();return}i.data=n;i.loaderBase.isReady()?(i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml()):i.interval=setInterval(function(){i.loaderBase.isReady()&&(clearInterval(i.interval),i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml())},i.intervalTimeToWaitForReady)}).error(function(){i.handleJsonInvalidData()})};FXStreetWidgets.Widget.Base.prototype.setDatesToJson=function(n,t){var i=FXStreetWidgets.Util.formatDate(t);return n.LastUpdatedDate=t,n.LastUpdatedHour=i,n};FXStreetWidgets.Widget.Base.prototype.renderHtml=function(){};FXStreetWidgets.Widget.Base.prototype.log=function(n){FXStreetWidgets.Util.log(n)};FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid=function(n){return FXStreetWidgets.Util.isValid(n)&&FXStreetWidgets.Util.arrayIsValid(n.Values)&&FXStreetWidgets.Util.isValid(n.Values[0])};FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData=function(){var t=this,n=t.loaderBase.config.Translations.NoDataAvailable;FXStreetWidgets.Util.isValid(n)||(n="No data available");t.Container.html(n)}})(),function(n){FXStreetWidgets.Widget.LoaderBase=function(t){var i={};return i.options=t,i.config=FXStreetWidgets.Widget.LoaderBase.prototype.config,i.isReady=FXStreetWidgets.Widget.LoaderBase.prototype.isReady,i.isReadyCustomCheck=FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck,i.initConfiguration=FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration,i.getContainer=FXStreetWidgets.Widget.LoaderBase.prototype.getContainer,i.getHost=FXStreetWidgets.Widget.LoaderBase.prototype.getHost,i.getVersion=FXStreetWidgets.Widget.LoaderBase.prototype.getVersion,i.getCustomJs=FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs,i.getSharedJs=FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs,i.getEndPoint=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint,i.getEndPointTranslation=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation,i.initWidgets=FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets,i.log=FXStreetWidgets.Widget.LoaderBase.prototype.log,i.chartLibrariesAreLoaded=FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded,i.mustachesCount=0,i.mustachesLoadedCount=0,i.customJsCount=0,i.customJsLoadedCount=0,i.sharedJsCount=0,i.sharedJsLoadedCount=0,i.translationsLoaded=!1,i.haveCustomJs=!1,i.haveSharedJs=!1,i.init=function(){if(!FXStreetWidgets.Util.isValid(i.options)||!FXStreetWidgets.Util.isValid(i.options.WidgetName)||!i.options.WidgetName.trim()){i.log("unable to load fxswidget options bad configure.");return}FXStreetWidgets.Initialization.registerLoader(i.options.WidgetName,i);i.initConfiguration();i.loadUtils();var t=n("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");FXStreetWidgets.Util.async(function(){i.initWidgets(t)})},i.loadDeferred=function(n){i.log("loading deferred "+i.options.WidgetName);var t=n.find("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");i.initWidgets(t)},i.loadUtils=function(){FXStreetWidgets.Util.ajaxJsonGetter(i.config.EndPointTranslation).done(function(n){i.translationsLoaded=!0;i.config.Translations=n.Values});n.each(i.config.CustomJs,function(n,t){i.customJsCount++;var u="",r="",f;typeof t=="string"?(r=t,u=FXStreetWidgets.Configuration.getCoreJsUrl(r)):t&&typeof t=="object"&&(r=t.Js,u=FXStreetWidgets.Configuration.getCoreJsUrl(r),f=t.CustomLoadedDelegate);FXStreetWidgets.ResourceManagerObj.load(r,FXStreetWidgets.ResourceType.Js,u,function(){i.customJsLoadedCount++},f)});n.each(i.config.SharedJs,function(n,t){i.sharedJsCount++;var r=FXStreetWidgets.Configuration.createResourceUrl(t.Container,t.Js);FXStreetWidgets.ResourceManagerObj.load(t.Js,FXStreetWidgets.ResourceType.Js,r,function(){i.sharedJsLoadedCount++},t.CustomLoadedDelegate)});n.each(i.config.Mustaches,function(n){i.mustachesCount++;var t=n+".html",r=FXStreetWidgets.Configuration.getMustacheUrl(t,i.options.WidgetName);FXStreetWidgets.ResourceManagerObj.load(t,FXStreetWidgets.ResourceType.Mustache,r,function(t){i.config.Mustaches[n]=t.Value;i.mustachesLoadedCount++})})},i.async_loadjs=function(n,t){var r=document.getElementsByTagName("script")[0],i=document.createElement("script");i.type="text/javascript";i.async=!0;i.src=n;t&&typeof t=="function"&&(i.addEventListener?i.addEventListener("load",t,!1):i.onreadystatechange=function(){(this.readyState==="complete"||this.readyState==="loaded")&&t.call()});r.parentNode.insertBefore(i,r)},i};FXStreetWidgets.Widget.LoaderBase.prototype.config={};FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets=function(){};FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration=function(){this.log("init configuration for: "+this.options.WidgetName);var n=this.getContainer(),t=this.getHost(n),i=this.getVersion(n),r=this.getCustomJs(),u=this.getSharedJs();this.config={WidgetName:this.options.WidgetName,Culture:FXStreetWidgets.Configuration.getCulture(),EndPoint:this.getEndPoint(t,i),EndPointTranslation:this.getEndPointTranslation(t,i),DefaultHost:this.options.DefaultHost,CustomJs:r,SharedJs:u,Mustaches:this.options.Mustaches,Translations:{}}};FXStreetWidgets.Widget.LoaderBase.prototype.getContainer=function(){return n("div[fxs_widget][fxs_name='"+this.options.WidgetName+"']").first()};FXStreetWidgets.Widget.LoaderBase.prototype.getHost=function(n){n=n||this.getContainer();var t=n.attr("fxs_host");return FXStreetWidgets.Util.isUndefined(t)?this.options.DefaultHost:t};FXStreetWidgets.Widget.LoaderBase.prototype.getVersion=function(n){n=n||this.getContainer();var t=n.attr("fxs_version")||this.options.DefaultVersion;return FXStreetWidgets.Util.isUndefined(t)?"":t};FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.CustomJs)&&(this.haveCustomJs=!0,n=this.options.CustomJs),n};FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.SharedJs)&&(this.haveSharedJs=!0,n=this.options.SharedJs),n};var t=function(n,t){return n.replace(/{version}/g,t).replace(/{culture}/g,FXStreetWidgets.Configuration.getCulture())};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint=function(n,i){var r,u;return this.options.EndPointV2?(u=t(this.options.EndPointV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPoint,r};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation=function(n,i){var r,u;return this.options.EndPointTranslationV2?(u=t(this.options.EndPointTranslationV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPointTranslation,r};FXStreetWidgets.Widget.LoaderBase.prototype.isReady=function(){var n=this.translationsLoaded===!0&&(this.haveCustomJs===!1||this.haveCustomJs===!0&&this.customJsLoadedCount>=this.customJsCount)&&(this.haveSharedJs===!1||this.haveSharedJs===!0&&this.sharedJsLoadedCount>=this.sharedJsCount)&&this.mustachesLoadedCount===this.mustachesCount;return n=n&&this.isReadyCustomCheck(),n===!0&&this.log("loader ready for: "+this.options.WidgetName),n};FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck=function(){return!0};FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded=function(){return typeof d3!="undefined"&&typeof c3!="undefined"};FXStreetWidgets.Widget.LoaderBase.prototype.log=function(n){FXStreetWidgets.Util.log(n)}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.CalendarEventTimer=function(t){var h=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(h),u,s;i.EventId="";i.WidgetId="";i.OtherEventsIds=null;i.HoursToShowNextevent=24;i.TimeZoneName="";i.CustomURL="";i.Seo=!1;i.Event=null;i.OtherEvents=null;i.TimeZone={};i.DateFormat="";u=!1;i.init=function(n){i.setSettingsByObject(n);var t=i.loaderBase.config.EndPoint+"eventtimer?hoursToShowActual={hours}&timezone={timeZone}&mainEvent={EventId}&otherEvents={otherEventsIds}";t=c(t);i.loadDataFromUrl(t)};i.jsonDataIsValid=function(n){return FXStreetWidgets.Util.isValid(n)};i.renderHtml=function(){l(i.data);var n={Event:i.Event,OtherEvents:i.OtherEvents,Translations:i.loaderBase.config.Translations,Seo:i.Seo,CultureName:FXStreetWidgets.Configuration.getCulture(),CustomURL:i.CustomURL},t=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches[i.loaderBase.config.WidgetName],n);i.Container.html(t);y();i.subscribeHttpPush(i.data.HttpPushServerUrl)};var c=function(n){return n.replace("{hours}",i.HoursToShowNextevent).replace("{timeZone}",i.TimeZoneName).replace("{EventId}",i.EventId).replace("{otherEventsIds}",i.OtherEventsIds)},l=function(n){i.Event||(i.Event=n.Event,i.OtherEvents=n.OtherEvents,i.DateFormat=n.DateFormat);a()},a=function(){if(i.Event){var t=FXStreetWidgets.Util.formatDateUtcOffset(i.Event.EventDate.DateUTC,i.TimeZone.HourOffset);i.Event.EventDateDisplayDate=i.DateFormat.replace("{0}",t);f(i.Event);i.Event.EventDate.RaisedClass=o(i.Event)}n.each(i.OtherEvents,function(n,t){v(t);f(t);t.EventDate.RaisedClass=o(t)})},f=function(t){var r=t.EventDate,u=t.Symbol!=="%"?t.Symbol+"{0}"+t.PotencySymbol:"{0}"+t.Symbol,f;r.ActualDisplay=n.isNumeric(r.Actual)?u.replace("{0}",r.Actual):"n/a";r.ConsensusDisplay=n.isNumeric(r.Consensus)?u.replace("{0}",r.Consensus):"n/a";n.isNumeric(r.Revised)?(r.PreviousDisplay=u.replace("{0}",r.Revised),n.isNumeric(r.Previous)&&(f=u.replace("{0}",r.Previous),r.RevisedDisplay=i.loaderBase.config.Translations.RevisedFrom.replace("{0}",f))):r.PreviousDisplay=n.isNumeric(r.Previous)?u.replace("{0}",r.Previous):"n/a"},v=function(n){n.EventDateDayDisplay=FXStreetWidgets.Util.formatDateUtcOffset(n.EventDate.DateUTC,i.TimeZone.HourOffset,"MMM D");var t=FXStreetWidgets.Util.formatDateUtcOffset(n.EventDate.DateUTC,i.TimeZone.HourOffset,"HH:mm");n.EventDateHourDisplay=i.DateFormat.replace("{0}",t)},y=function(){i.Event.ShowNextEvent&&p()},p=function(){if(FXStreetWidgets.Util.isValid(i.data)&&FXStreetWidgets.Util.isValid(i.Event.EventDate.DateUTC)){var u=new Date(i.Event.EventDate.DateUTC),t={daysDisplay:i.loaderBase.config.Translations.Days.toLowerCase(),hoursDisplay:i.loaderBase.config.Translations.Hours.toLowerCase(),minDisplay:i.loaderBase.config.Translations.Min.toLowerCase(),secDisplay:i.loaderBase.config.Translations.Sec.toLowerCase()},f=r("00 :",t.hoursDisplay)+r("00 :",t.minDisplay)+r("00",t.secDisplay);i.Container.find("#clock_"+i.Event.EventId).countdown(u).on("update.countdown",function(i){var r=w(i,t);n(this).html(i.strftime(r))}).on("finish.countdown",function(){n(this).html(f);e(i.Event)})}},w=function(n,t){return n.strftime("%D")==="00"?r("%H :",t.hoursDisplay)+r("%M :",t.minDisplay)+r("%S",t.secDisplay):r("%D :",t.daysDisplay)+r("%H :",t.hoursDisplay)+r("%M",t.minDisplay)},b=function(n){n.ShowNextEvent=!1},e=function(n){b(n);i.renderHtml()},k=function(n,t){n.Actual&&(t.EventDate.Actual=n.Actual);t.IsBetter=n.IsBetter;n.Revised&&(t.EventDate.Previous=n.Revised);e(t)},o=function(n){var t="fxs_black_price";return n.IsBetter?t="fxs_green_price":n.IsBetter===!1&&(t="fxs_red_price"),t},r=function(n,t){return'<span><span class="fxs_widget_custom_data_lable">'+n+"<\/span>"+t+"<\/span>"};return i.subscribeHttpPush=function(n){if(!u)if(FXStreetPush!==undefined){var t={tokenUrl:n+"api/clientkeys",httpPushServerUrl:n+"signalr/hubs",culture:FXStreetWidgets.Configuration.getCulture()},i=FXStreetPush.PushNotification.getInstance(t);i.calendarSubscribe(s);u=!0}else console.log("FXStreetPush load failed")},s=function(t){var r,u;t&&(r=n.grep(i.OtherEvents,function(n){return n.EventDate.EventDateId===t.EventDateId}),(r[0]||t.EventDateId==i.Event.EventDate.EventDateId)&&(u=r[0]?r[0]:i.Event,k(t,u)))},i}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.LoaderCalendarEventTimer=function(){var r={WidgetName:"calendareventtimer",EndPoint:"",EndPointTranslation:"eventtimer/localization",DefaultHost:"https://calendar.fxstreet.com/",Mustaches:{calendareventtimer:""},CustomJs:[{Js:"jquery.countdown.min.js",CustomLoadedDelegate:function(){return n!==undefined&&n.fn.countdown!==undefined}}],SharedJs:[{Container:"http-push/",Js:"jquery.signalR-2.2.0.min.js",CustomLoadedDelegate:function(){return n!==undefined&&n.signalR!==undefined}},{Container:"http-push/",Js:"fxspush.js",CustomLoadedDelegate:function(){return window.FXStreetPush!==undefined}}]},i=FXStreetWidgets.Widget.LoaderBase(r),t=FXStreetWidgets.Util.extendObject(i);return i.initWidgets=function(i){n.each(i,function(i,r){var u=n(r),f={Container:u,EventId:u.attr("fxs_eventid"),OtherEventsIds:u.attr("fxs_other_events_ids"),HoursToShowNextevent:u.attr("fxs_hours_to_show_next_event"),TimeZoneName:u.attr("fxs_time_zone"),CustomURL:u.attr("fxs_custom_url"),WidgetId:FXStreetWidgets.Util.guid(),Seo:FXStreetWidgets.Util.isUndefined(u.attr("fxs_seo"))?!1:!0},e;FXStreetWidgets.Util.isUndefined(f.EventId)?console.log("fxserror unable to create "+t.config.WidgetName+", event not valid: "+f.EventId):(e=new FXStreetWidgets.Widget.CalendarEventTimer(t),e.init(f))})},t},function(){var n=new FXStreetWidgets.Widget.LoaderCalendarEventTimer;n.init()}()}(FXStreetWidgets.$);
//# sourceMappingURL=calendareventtimer.min.js.map