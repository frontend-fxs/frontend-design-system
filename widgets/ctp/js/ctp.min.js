(function(){FXStreetWidgets.Widget.Base=function(n){var t={};return t.Container=FXStreetWidgets.Widget.Base.prototype.Container,t.loaderBase=n,t.data=FXStreetWidgets.Widget.Base.prototype.data,t.interval=FXStreetWidgets.Widget.Base.prototype.interval,t.init=FXStreetWidgets.Widget.Base.prototype.init,t.setSettingsByObject=FXStreetWidgets.Widget.Base.prototype.setSettingsByObject,t.addEvents=FXStreetWidgets.Widget.Base.prototype.addEvents,t.setVars=FXStreetWidgets.Widget.Base.prototype.setVars,t.loadData=FXStreetWidgets.Widget.Base.prototype.loadData,t.loadDataFromUrl=FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl,t.setDatesToJson=FXStreetWidgets.Widget.Base.prototype.setDatesToJson,t.renderHtml=FXStreetWidgets.Widget.Base.prototype.renderHtml,t.log=FXStreetWidgets.Widget.Base.prototype.log,t.jsonDataIsValid=FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid,t.handleJsonInvalidData=FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData,t};FXStreetWidgets.Widget.Base.prototype.Container=null;FXStreetWidgets.Widget.Base.prototype.loaderBase=null;FXStreetWidgets.Widget.Base.prototype.data=null;FXStreetWidgets.Widget.Base.prototype.interval=null;FXStreetWidgets.Widget.Base.prototype.init=function(n){this.setSettingsByObject(n)};FXStreetWidgets.Widget.Base.prototype.setSettingsByObject=function(n){for(var t in n)n.hasOwnProperty(t)&&this[t]!==undefined&&(this[t]=n[t])};FXStreetWidgets.Widget.Base.prototype.addEvents=function(){};FXStreetWidgets.Widget.Base.prototype.setVars=function(){};FXStreetWidgets.Widget.Base.prototype.loadData=function(n){this.loadDataFromUrl(this.loaderBase.config.EndPoint,n)};FXStreetWidgets.Widget.Base.prototype.loadDataFromUrl=function(n,t){var i=this;FXStreetWidgets.Util.ajaxJsonGetter(n,t).done(function(n){if(!i.jsonDataIsValid(n)){i.handleJsonInvalidData();return}i.data=n;i.loaderBase.isReady()?(i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml()):i.interval=setInterval(function(){i.loaderBase.isReady()&&(clearInterval(i.interval),i.log("start renderHtml for: "+i.loaderBase.config.WidgetName),i.renderHtml())},i.intervalTimeToWaitForReady)})};FXStreetWidgets.Widget.Base.prototype.setDatesToJson=function(n,t){var i=FXStreetWidgets.Util.formatDate(t);return n.LastUpdatedDate=t,n.LastUpdatedHour=i,n};FXStreetWidgets.Widget.Base.prototype.renderHtml=function(){};FXStreetWidgets.Widget.Base.prototype.log=function(n){FXStreetWidgets.Util.log(n)};FXStreetWidgets.Widget.Base.prototype.jsonDataIsValid=function(n){return FXStreetWidgets.Util.isValid(n)&&FXStreetWidgets.Util.arrayIsValid(n.Values)&&FXStreetWidgets.Util.isValid(n.Values[0])};FXStreetWidgets.Widget.Base.prototype.handleJsonInvalidData=function(){var t=this,n=t.loaderBase.config.Translations.NoDataAvailable;FXStreetWidgets.Util.isValid(n)||(n="No data available");t.Container.html(n)}})(),function(n){FXStreetWidgets.Widget.LoaderBase=function(t){var i={};return i.options=t,i.config=FXStreetWidgets.Widget.LoaderBase.prototype.config,i.isReady=FXStreetWidgets.Widget.LoaderBase.prototype.isReady,i.isReadyCustomCheck=FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck,i.initConfiguration=FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration,i.getContainer=FXStreetWidgets.Widget.LoaderBase.prototype.getContainer,i.getHost=FXStreetWidgets.Widget.LoaderBase.prototype.getHost,i.getVersion=FXStreetWidgets.Widget.LoaderBase.prototype.getVersion,i.getCustomJs=FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs,i.getSharedJs=FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs,i.getEndPoint=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint,i.getEndPointTranslation=FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation,i.initWidgets=FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets,i.log=FXStreetWidgets.Widget.LoaderBase.prototype.log,i.chartLibrariesAreLoaded=FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded,i.getDefaultHost=FXStreetWidgets.Widget.LoaderBase.prototype.getDefaultHost,i.mustachesCount=0,i.mustachesLoadedCount=0,i.customJsCount=0,i.customJsLoadedCount=0,i.sharedJsCount=0,i.sharedJsLoadedCount=0,i.translationsLoaded=!1,i.haveCustomJs=!1,i.haveSharedJs=!1,i.init=function(){if(!FXStreetWidgets.Util.isValid(i.options)||!FXStreetWidgets.Util.isValid(i.options.WidgetName)||!i.options.WidgetName.trim()){i.log("unable to load fxswidget options bad configure.");return}FXStreetWidgets.Initialization.registerLoader(i.options.WidgetName,i);i.initConfiguration();i.loadUtils();var t=n("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");FXStreetWidgets.Util.async(function(){i.initWidgets(t)})},i.loadDeferred=function(n){i.log("loading deferred "+i.options.WidgetName);var t=n.find("div[fxs_widget][fxs_name='"+i.options.WidgetName+"']");i.initWidgets(t)},i.loadUtils=function(){FXStreetWidgets.Util.ajaxJsonGetter(i.config.EndPointTranslation).done(function(n){i.translationsLoaded=!0;i.config.Translations=n.Values});n.each(i.config.CustomJs,function(n,t){i.customJsCount++;var u="",r="",f;typeof t=="string"?(r=t,u=FXStreetWidgets.Configuration.getCoreJsUrl(r)):t&&typeof t=="object"&&(r=t.Js,u=FXStreetWidgets.Configuration.getCoreJsUrl(r),f=t.CustomLoadedDelegate);FXStreetWidgets.ResourceManagerObj.load(r,FXStreetWidgets.ResourceType.Js,u,function(){i.customJsLoadedCount++},f)});n.each(i.config.SharedJs,function(n,t){i.sharedJsCount++;var r=FXStreetWidgets.Configuration.createResourceUrl(t.Container,t.Js);FXStreetWidgets.ResourceManagerObj.load(t.Js,FXStreetWidgets.ResourceType.Js,r,function(){i.sharedJsLoadedCount++},t.CustomLoadedDelegate)});n.each(i.config.Mustaches,function(n){i.mustachesCount++;var t=n+".html",r=FXStreetWidgets.Configuration.getMustacheUrl(t,i.options.WidgetName);FXStreetWidgets.ResourceManagerObj.load(t,FXStreetWidgets.ResourceType.Mustache,r,function(t){i.config.Mustaches[n]=t.Value;i.mustachesLoadedCount++})})},i.async_loadjs=function(n,t){var r=document.getElementsByTagName("script")[0],i=document.createElement("script");i.type="text/javascript";i.async=!0;i.src=n;t&&typeof t=="function"&&(i.addEventListener?i.addEventListener("load",t,!1):i.onreadystatechange=function(){(this.readyState==="complete"||this.readyState==="loaded")&&t.call()});r.parentNode.insertBefore(i,r)},i};FXStreetWidgets.Widget.LoaderBase.prototype.config={};FXStreetWidgets.Widget.LoaderBase.prototype.initWidgets=function(){};FXStreetWidgets.Widget.LoaderBase.prototype.initConfiguration=function(){this.log("init configuration for: "+this.options.WidgetName);var n=this.getContainer(),t=this.getHost(n),i=this.getVersion(n),r=this.getCustomJs(),u=this.getSharedJs();this.config={WidgetType:this.options.WidgetType,WidgetName:this.options.WidgetName,Culture:FXStreetWidgets.Configuration.getCulture(),EndPoint:this.getEndPoint(t,i),EndPointTranslation:this.getEndPointTranslation(t,i),DefaultHost:this.getDefaultHost(this.options),CustomJs:r,SharedJs:u,Mustaches:this.options.Mustaches,Translations:{}}};FXStreetWidgets.Widget.LoaderBase.prototype.getDefaultHost=function(n){var t=FXStreetWidgets.Configuration.getHosts(),i,r;return t?(i=t[n.WidgetType],r=i||n.DefaultHost,r):n.DefaultHost};FXStreetWidgets.Widget.LoaderBase.prototype.getContainer=function(){return n("div[fxs_widget][fxs_name='"+this.options.WidgetName+"']").first()};FXStreetWidgets.Widget.LoaderBase.prototype.getHost=function(n){n=n||this.getContainer();var t=n.attr("fxs_host");return FXStreetWidgets.Util.isUndefined(t)?this.getDefaultHost(this.options):t};FXStreetWidgets.Widget.LoaderBase.prototype.getVersion=function(n){n=n||this.getContainer();var t=n.attr("fxs_version")||this.options.DefaultVersion;return FXStreetWidgets.Util.isUndefined(t)?"":t};FXStreetWidgets.Widget.LoaderBase.prototype.getCustomJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.CustomJs)&&(this.haveCustomJs=!0,n=this.options.CustomJs),n};FXStreetWidgets.Widget.LoaderBase.prototype.getSharedJs=function(){var n=[];return FXStreetWidgets.Util.arrayIsValid(this.options.SharedJs)&&(this.haveSharedJs=!0,n=this.options.SharedJs),n};var t=function(n,t){return n.replace(/{version}/g,t).replace(/{culture}/g,FXStreetWidgets.Configuration.getCulture())};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPoint=function(n,i){var r,u;return this.options.EndPointV2?(u=t(this.options.EndPointV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPoint,r};FXStreetWidgets.Widget.LoaderBase.prototype.getEndPointTranslation=function(n,i){var r,u;return this.options.EndPointTranslationV2?(u=t(this.options.EndPointTranslationV2,i),r=n+u):r=n+(i?i+"/":"")+FXStreetWidgets.Configuration.getCulture()+"/"+this.options.EndPointTranslation,r};FXStreetWidgets.Widget.LoaderBase.prototype.isReady=function(){var n=this.translationsLoaded===!0&&(this.haveCustomJs===!1||this.haveCustomJs===!0&&this.customJsLoadedCount>=this.customJsCount)&&(this.haveSharedJs===!1||this.haveSharedJs===!0&&this.sharedJsLoadedCount>=this.sharedJsCount)&&this.mustachesLoadedCount===this.mustachesCount;return n=n&&this.isReadyCustomCheck(),n===!0&&this.log("loader ready for: "+this.options.WidgetName),n};FXStreetWidgets.Widget.LoaderBase.prototype.isReadyCustomCheck=function(){return!0};FXStreetWidgets.Widget.LoaderBase.prototype.chartLibrariesAreLoaded=function(){return typeof d3!="undefined"&&typeof c3!="undefined"};FXStreetWidgets.Widget.LoaderBase.prototype.log=function(n){FXStreetWidgets.Util.log(n)}}(FXStreetWidgets.$),function(){FXStreetWidgets.Chart.Base=function(){return _this={},_this.chart=FXStreetWidgets.Chart.Base.prototype.chart,_this.init=FXStreetWidgets.Chart.Base.prototype.init,_this.setSettingsByObject=FXStreetWidgets.Chart.Base.prototype.setSettingsByObject,_this.getPrintJson=FXStreetWidgets.Chart.Base.prototype.getPrintJson,_this.print=FXStreetWidgets.Chart.Base.prototype.print,_this.delayAnimations=FXStreetWidgets.Chart.Base.prototype.delayAnimations,_this.log=FXStreetWidgets.Chart.Base.prototype.log,_this};FXStreetWidgets.Chart.Base.prototype.chart=null;FXStreetWidgets.Chart.Base.prototype.init=function(n){this.log("init chart");this.setSettingsByObject(n);this.print(this.getPrintJson())};FXStreetWidgets.Chart.Base.prototype.setSettingsByObject=function(n){for(var t in n)n.hasOwnProperty(t)&&this[t]!==undefined&&(this[t]=n[t])};FXStreetWidgets.Chart.Base.prototype.getPrintJson=function(){};FXStreetWidgets.Chart.Base.prototype.print=function(n){this.log("print chart");this.chart=c3.generate(n);this.delayAnimations()};FXStreetWidgets.Chart.Base.prototype.delayAnimations=function(){};FXStreetWidgets.Chart.Base.prototype.log=function(n){FXStreetWidgets.Util.log(n)}}(),function(){FXStreetWidgets.Chart.CtpSpeedometer=function(){var t=FXStreetWidgets.Chart.Base(),n=FXStreetWidgets.Util.extendObject(t);return n.delayTimeForAnimationInSpeedometerResize=100,n.delayTimeForAnimationInSpeedometerLoad=250,n.SellStaticsPercent=null,n.Id="",t.delayAnimations=function(){setTimeout(function(){n.chart.resize({columns:[["Buy",100],["Sell",undefined]]})},n.delayTimeForAnimationInSpeedometerResize);setTimeout(function(){n.chart.load({columns:[["Buy",100],["Sell",n.SellStaticsPercent]]})},n.delayTimeForAnimationInSpeedometerLoad)},t.getPrintJson=function(){var t=n.SellStaticsPercent<100?["#CE4735","#CE4735","#328372"]:["#CE4735"];return{bindto:"#"+n.Id,data:{columns:[["Buy",0],["Sell",0]],type:"gauge"},zoom:{enabled:!1},gauge:{label:{show:!1},units:" %",width:6},color:{pattern:t,threshold:{values:[0,100]}},size:{height:100,width:190},tooltip:{show:!1},interaction:{enabled:!1}}},n}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Chart.CtpBars=function(){var i=FXStreetWidgets.Chart.Base(),t=FXStreetWidgets.Util.extendObject(i);return t.DelayTimeForAnimationInBars=1e3,t.Id="",t.Signals={},t.Translations={},t.SellArray=[],t.BuyArray=[],t.SellArrayEmpty=[],t.BuyArrayEmpty=[],t.SignalsArray=[],i.init=function(i){t.setSettingsByObject(i);t.SignalsArray=["x"];t.SellArray=[t.Translations.Sell];t.BuyArray=[t.Translations.Buy];t.SellArrayEmpty=[t.Translations.Sell];t.BuyArrayEmpty=[t.Translations.Buy];var r=[];n.each(t.Signals,function(n,t){var i=t.OrderDirection==="SELL"||t.OrderDirection==="SHORT";r.push({Value:t.Entry,IsSell:i});t.StopLoss&&r.push({Value:t.StopLoss,IsSell:!i});t.TakeProfit1&&r.push({Value:t.TakeProfit1,IsSell:!i});t.TakeProfit2&&r.push({Value:t.TakeProfit2,IsSell:!i});t.TakeProfit3&&r.push({Value:t.TakeProfit3,IsSell:!i})});r.sort(function(n,t){return parseFloat(n.Value)-parseFloat(t.Value)});t.handleEqualValues(r);n.each(r,function(n,i){t.SellArrayEmpty.push(0);t.BuyArrayEmpty.push(0);t.SignalsArray.push(i.Value);i.IsSell?(t.SellArray.push(1),t.BuyArray.push(0)):(t.SellArray.push(0),t.BuyArray.push(1))});t.print(t.getPrintJson())},t.handleEqualValues=function(n){var i,r,t,u;if(n!==null)for(i=0;i<n.length;i++)for(r=0,t=i+1;t<n.length;t++)i!==t&&parseFloat(n[i].Value)===parseFloat(n[t].Value)&&(u=+(1e-5+r/1e5).toFixed(5),n[t].Value=(parseFloat(n[t].Value)+u).toFixed(5).toString(),r++)},i.delayAnimations=function(){setTimeout(function(){t.chart.load({columns:[t.BuyArray,t.SellArray]})},t.DelayTimeForAnimationInBars)},i.getPrintJson=function(){var n={};return n[t.Translations.Sell]="#CE4735",n[t.Translations.Buy]="#338473",{bindto:"#"+t.Id,data:{x:"x",columns:[t.SignalsArray,t.SellArrayEmpty,t.BuyArrayEmpty],type:"bar",colors:n},bar:{width:2},padding:{left:16},size:{height:105},tooltip:{show:!0,format:{title:function(n){return n},value:function(n,t){return t}}},axis:{y:{show:!1},x:{tick:{values:t.getTickValues(t.SignalsArray.slice(1,t.SignalsArray.length))}}},legend:{position:"right"}}},t.getSignalsAvg=function(n){for(var r,t=0,u=n[0].length,i=0;i<n.length;i++)r=parseFloat(n[i]),t=t+r;return(t/n.length).toString().slice(0,u)},t.getTickValues=function(n){return n.sort(),[n[0],t.getSignalsAvg(n),n[n.length-1]]},t}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.Ctp=function(t){var r=FXStreetWidgets.Widget.Base(t),i=FXStreetWidgets.Util.extendObject(r),u,f;return i.AssetId="",i.ClassSize="",i.HideFullReport="",i.FullReportUrl="",i.WidgetId=null,i.Seo=!1,i.ChartSpeedometerId="gauge_chart",i.ChartBarsId="orders_chart",i.init=function(n){i.setSettingsByObject(n);var t=this.loaderBase.config.EndPoint+"?assetids="+i.AssetId;i.loadDataFromUrl(t)},u=r.jsonDataIsValid,i.jsonDataIsValid=function(n){return u(n)&&FXStreetWidgets.Util.arrayIsValid(n.Values[0].Entries)},i.renderHtml=function(){var n=i.data.Values[0],t,r;f(n,n.Asset.DecimalPlaces);t={Study:n,Translations:i.loaderBase.config.Translations,FullReportUrl:i.FullReportUrl.toLowerCase(),Seo:i.Seo};t=i.setDatesToJson(t,n.Date);r=FXStreetWidgets.Util.renderByHtmlTemplate(i.loaderBase.config.Mustaches[i.loaderBase.config.WidgetName],t);i.Container.html(r);i.manageRenderedHtml();i.printCharts(n)},i.manageRenderedHtml=function(){i.addSizeClass();i.handleFullReport()},i.addSizeClass=function(){i.ClassSize&&i.Container.find(".fxs_ctp_widget").addClass(i.ClassSize)},i.handleFullReport=function(){i.HideFullReport&&i.Container.find(".fxs_btn.fxs_btn_line.fxs_btn_small").remove()},i.printCharts=function(n){i.instanciateSpeedpometer(n);i.instanciateBars(n)},i.instanciateSpeedpometer=function(n){var t=i.ChartSpeedometerId+i.WidgetId,r=i.Container.find("#"+i.ChartSpeedometerId),u,f;r&&r.attr("id",t);u={SellStaticsPercent:n.SellStatics.Percent,Id:t};f=new FXStreetWidgets.Chart.CtpSpeedometer;f.init(u)},i.instanciateBars=function(n){var t=i.ChartBarsId+i.WidgetId,r=i.Container.find("#"+i.ChartBarsId),u,f;r&&r.attr("id",t);u={Id:t,Signals:n.Entries,Translations:i.loaderBase.config.Translations};f=new FXStreetWidgets.Chart.CtpBars;f.init(u)},f=function(t,i){t.Entries.forEach(function(n){n.Entry&&(n.Entry=n.Entry.toFixed(i));n.StopLoss&&(n.StopLoss=n.StopLoss.toFixed(i));n.TakeProfit1&&(n.TakeProfit1=n.TakeProfit1.toFixed(i));n.TakeProfit2&&(n.TakeProfit2=n.TakeProfit2.toFixed(i));n.TakeProfit3&&(n.TakeProfit3=n.TakeProfit3.toFixed(i))});t.BuyStatics.AveragePrice=n.isNumeric(t.BuyStatics.AveragePrice)?t.BuyStatics.AveragePrice.toFixed(i):t.BuyStatics.AveragePrice;t.SellStatics.AveragePrice=n.isNumeric(t.SellStatics.AveragePrice)?t.SellStatics.AveragePrice.toFixed(i):t.SellStatics.AveragePrice},i}}(FXStreetWidgets.$),function(n){FXStreetWidgets.Widget.LoaderCtp=function(){var t=FXStreetWidgets.Widget.LoaderBase({WidgetType:"MarketTools",WidgetName:"ctp",EndPointV2:"api/v2/ctp/{culture}/study/",EndPointTranslationV2:"api/v2/cultures/{culture}/ctp/",DefaultHost:"https://markettools.fxstreet.com/",Mustaches:{ctp:""},DefaultVersion:"v2",CustomJs:["c3.min.js","d3.min.js"]}),i=FXStreetWidgets.Util.extendObject(t);return t.initWidgets=function(t){n.each(t,function(t,r){var u=n(r),f={Container:u,AssetId:u.attr("fxs_asset"),ClassSize:u.attr("fxs_class_size"),HideFullReport:FXStreetWidgets.Util.isUndefined(u.attr("fxs_hide_fullreport"))?!1:!0,FullReportUrl:u.attr("fxs_fullreport_url"),WidgetId:FXStreetWidgets.Util.guid(),Seo:FXStreetWidgets.Util.isUndefined(u.attr("fxs_seo"))?!1:!0},e;FXStreetWidgets.Util.isUndefined(f.FullReportUrl)&&(f.FullReportUrl="/");FXStreetWidgets.Util.isUndefined(f.AssetId)||!f.AssetId.startsWith("fxs-")?console.log("fxserror unable to create "+i.config.WidgetName+", asset not valid: "+f.AssetId):(e=new FXStreetWidgets.Widget.Ctp(i),e.init(f))})},t.isReadyCustomCheck=function(){return t.chartLibrariesAreLoaded()},i},function(){var n=new FXStreetWidgets.Widget.LoaderCtp;n.init()}()}(FXStreetWidgets.$);
//# sourceMappingURL=ctp.min.js.map